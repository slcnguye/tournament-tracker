<div id="tournament-detail" class="container">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a ui-sref="tournament">Tournaments</a></li>
    <li class="breadcrumb-item active" ng-bind="$ctrl.tournament.name"></li>
  </ol>

  <div class="panel panel-default">
    <div class="panel-heading action-heading">
      <span>Players</span>
      <button class="btn btn-sm btn-default" ui-sref="add-player({ tournamentId: $ctrl.tournamentId })">
        <i class="fa fa-plus" aria-hidden="true"></i>
      </button>
    </div>
    <table class="table">
      <thead>
      <th>Rank</th>
      <th>Name</th>
      <th>Score</th>
      </thead>
      <tbody>
      <tr ng-repeat="tournamentPlayer in $ctrl.tournamentPlayers | orderBy: 'score':true ">
        <td ng-bind="$index + 1"></td>
        <td ng-bind="tournamentPlayer.name"></td>
        <td ng-bind="tournamentPlayer.score"></td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading action-heading">
      <span>Matches</span>
      <button ng-show="!$ctrl.addMatching" class="btn btn-sm btn-default" ng-click="$ctrl.addMatch()">
        <i class="fa fa-plus" aria-hidden="true"></i>
      </button>
    </div>
    <div class="panel-body" ng-if="$ctrl.addMatching">
      <div class="row">
        <div class="col-xs-5">
          <div class="input-group player-input-group">
            <span class="input-group-addon">
              <i class="fa fa-trophy" aria-hidden="true"></i>
              <div ng-bind="'+' + $ctrl.calculateScoreForWinner($ctrl.matchPlayer1, $ctrl.matchPlayer2)"></div>
            </span>
            <input type="text" ng-model="$ctrl.matchPlayer1" class="form-control player-input"
                   uib-typeahead="player as player.name for player in $ctrl.tournamentPlayers | filter:$viewValue | limitTo:8"
                   placeholder="Match Winner...">
          </div>
        </div>
        <div class="col-xs-5">
          <div class="input-group player-input-group">
            <span class="input-group-addon">
              <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
              <div ng-bind="$ctrl.calculateScoreForLoser($ctrl.matchPlayer1, $ctrl.matchPlayer2) || '-'"></div>
            </span>
            <input type="text" ng-model="$ctrl.matchPlayer2" class="form-control player-input"
                   uib-typeahead="player as player.name for player in $ctrl.tournamentPlayers | filter:$viewValue | limitTo:8"
                   placeholder="Match Contender...">
          </div>
        </div>
        <div class="pull-right">
          <button class="btn btn-default"
                  type="submit"
                  ng-disabled="(!$ctrl.playersById[$ctrl.matchPlayer1.playerId] || !$ctrl.playersById[$ctrl.matchPlayer2.playerId]) || $ctrl.playersById[$ctrl.matchPlayer1.playerId] == $ctrl.playersById[$ctrl.matchPlayer2.playerId]"
                  ng-click="$ctrl.saveMatch($ctrl.matchPlayer1, $ctrl.matchPlayer2)">
            Save
          </button>
          <button class="btn btn-link" ng-click="$ctrl.cancelMatch()">
            Cancel
          </button>
        </div>
      </div>
    </div>
    <table class="table">
      <thead>
      <th>Match</th>
      <th>Players</th>
      <th>Date</th>
      </thead>
      <tbody>
      <tr ng-if="$ctrl.matches.length === 0">
        <td colspan="100%">No matches played.</td>
      </tr>
      <tr ng-repeat="match in $ctrl.matches | orderBy: 'createdAt':true">
        <td ng-bind="$ctrl.matches.length - $index"></td>
        <td>
          <i class="fa fa-trophy" aria-hidden="true"></i>
          <span ng-bind="$ctrl.tournamentPlayersById[match['match-results'][0].tournamentPlayerId].name"></span>
          <span>vs.</span>
          <span ng-bind="$ctrl.tournamentPlayersById[match['match-results'][1].tournamentPlayerId].name"></span>
        </td>
        <td ng-bind="match.createdAt | date:'mediumDate'"></td>
      </tr>
      </tbody>
    </table>
  </div>

</div>
